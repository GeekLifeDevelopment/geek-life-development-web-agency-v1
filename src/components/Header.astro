---
import newLogoUrl from '../assets/brand/new-logo.png';
import wordmarkUrl from '../assets/brand/wordmark.svg?url';
import Button from './ui/Button.astro';
import Container from './ui/Container.astro';
import { navLinks } from '../data/site';
---

<header
  data-site-header
  class="sticky top-0 z-40 border-b border-slate-200/80 bg-white/95 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-white/85"
>
  <Container class="flex h-18 items-center justify-between gap-4">
    <a href="/" class="inline-flex shrink-0 items-center gap-3" aria-label="Geek Life Development home">
      <img src={newLogoUrl.src} alt="Geek Life Development logo" width="38" height="38" class="h-[38px] w-[38px] shrink-0 object-contain" loading="eager" decoding="async" />
      <img src={wordmarkUrl} alt="Geek Life Development" width="210" height="32" class="h-8 w-auto" loading="eager" decoding="async" />
    </a>

    <nav class="hidden items-center gap-6 text-sm font-medium md:flex" aria-label="Primary navigation">
      {
        navLinks.map((link) => (
          <a href={link.href} class="text-slate-700 transition hover:text-[var(--color-accent)] hover:no-underline">
            {link.label}
          </a>
        ))
      }
    </nav>

    <div class="hidden md:flex">
      <Button href="/contact" size="sm">Get a quote</Button>
    </div>

    <button
      type="button"
      class="inline-flex h-11 w-11 items-center justify-center rounded-xl border border-slate-200 text-slate-800 md:hidden"
      data-menu-toggle
      aria-controls="mobile-nav"
      aria-expanded="false"
      aria-label="Toggle menu"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="h-5 w-5"
        aria-hidden="true"
      >
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
  </Container>

  <div id="mobile-nav" class="hidden border-t border-slate-200 bg-white md:hidden" data-mobile-nav aria-hidden="true">
    <Container class="py-4">
      <nav class="flex flex-col gap-3" aria-label="Mobile navigation">
        {
          navLinks.map((link) => (
            <a
              href={link.href}
              class="rounded-lg px-2 py-3 font-medium text-slate-700 hover:bg-slate-100 hover:no-underline"
              data-mobile-link
            >
              {link.label}
            </a>
          ))
        }
      </nav>
      <div class="mt-4 border-t border-slate-100 pt-4">
        <Button href="/contact" size="sm" class="w-full">Get a quote</Button>
      </div>
    </Container>
  </div>
</header>

<script is:inline>
  const header = document.querySelector('[data-site-header]');
  const toggle = header?.querySelector('[data-menu-toggle]');
  const mobileNav = header?.querySelector('[data-mobile-nav]');
  const mobileLinks = header?.querySelectorAll('[data-mobile-link]') ?? [];
  let lastFocused = null;

  const closeMenu = (restoreFocus = true) => {
    if (!toggle || !mobileNav) {
      return;
    }

    toggle.setAttribute('aria-expanded', 'false');
    mobileNav.classList.add('hidden');
    mobileNav.setAttribute('aria-hidden', 'true');

    if (restoreFocus && lastFocused instanceof HTMLElement) {
      lastFocused.focus();
    }
  };

  if (toggle && mobileNav) {
    toggle.addEventListener('click', () => {
      const expanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', expanded ? 'false' : 'true');
      mobileNav.classList.toggle('hidden');
      mobileNav.setAttribute('aria-hidden', expanded ? 'true' : 'false');

      if (!expanded) {
        lastFocused = document.activeElement;
        const firstLink = mobileNav.querySelector('[data-mobile-link]');
        if (firstLink instanceof HTMLElement) {
          firstLink.focus();
        }
      } else {
        closeMenu();
      }
    });

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && toggle.getAttribute('aria-expanded') === 'true') {
        closeMenu();
      }
    });

    mobileLinks.forEach((link) => {
      link.addEventListener('click', closeMenu);
    });
  }
</script>
